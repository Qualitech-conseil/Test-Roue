<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Roue de la Fortune</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin: 0;
      background: url('background.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    header img {
      margin-top: 30px;
      width: 150px;
    }
    h2 {
      color: #fff;
      margin: 10px;
      font-size: 1.5em;
    }
    canvas {
      display: block;
      margin: 40px auto;
    }
    #popup {
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.8);
      color: white;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 9999;
    }
    #popupContent {
      background: #222;
      padding: 30px;
      border-radius: 15px;
      max-width: 90%;
      text-align: center;
    }
    #popup button {
      margin-top: 20px;
      padding: 12px 24px;
      font-size: 18px;
      cursor: pointer;
    }
    #result {
      font-size: 24px;
      color: white;
      margin-top: 20px;
      font-weight: bold;
    }
    #emailField {
      margin-top: 20px;
    }
    #emailField input {
      padding: 10px;
      width: 250px;
      font-size: 16px;
    }
    #emailField button {
      margin-left: 10px;
      padding: 10px 20px;
      font-size: 16px;
    }
    .confetti {
      position: absolute;
      width: 10px;
      height: 10px;
      background-color: red;
      animation: fall 2s linear infinite;
    }
    @keyframes fall {
      0% { transform: translateY(0) rotate(0); opacity: 1; }
      100% { transform: translateY(600px) rotate(360deg); opacity: 0; }
    }
  </style>
</head>
<body>

  <header>
    <img src="logo.png" alt="Logo">
    <h2>Jouer et tenter votre chance en nous laissant un avis Google</h2>
  </header>

  <canvas id="wheel" width="400" height="400"></canvas>
  <div id="result"></div>

  <div id="emailField" style="display: none;">
    <input type="email" id="userEmail" placeholder="Votre e-mail">
    <button id="sendEmailBtn">Envoyer l’e-mail</button>
  </div>

  <div id="popup">
    <div id="popupContent">
      <p id="popupText">Laisse un avis Google et tu pourras tenter ta chance en tournant la roue</p>
      <button id="popupButton">Laisser un avis Google</button>
    </div>
  </div>

  <script>
    // CONFIGURATION PRINCIPALE
    const nomRestaurant = "Le Bon Goût";
    const emailRestaurant = "contact@restaurant.com";
    const lienAvisGoogle = "https://www.google.com/maps/place/votre-restaurant"; // à personnaliser
    const nbCasesGagnantes = 4; // ← Modifier ce chiffre pour changer la répartition Gagné/Perdu

    const totalCases = 8;
    const gagnantLabel = "Gagné";
    const perdantLabel = "Perdu";

    // Génére les segments
    const segments = Array.from({ length: totalCases }, (_, i) => i < nbCasesGagnantes ? gagnantLabel : perdantLabel)
      .sort(() => Math.random() - 0.5);

    const colors = segments.map(s => s === "Gagné" ? "#4CAF50" : "#f44336");

    // Roue
    const canvas = document.getElementById("wheel");
    const ctx = canvas.getContext("2d");
    const segmentAngle = 2 * Math.PI / totalCases;
    let currentAngle = 0;

    function drawWheel() {
      ctx.clearRect(0, 0, 400, 400);
      for (let i = 0; i < segments.length; i++) {
        ctx.beginPath();
        ctx.moveTo(200, 200);
        ctx.fillStyle = colors[i];
        ctx.arc(200, 200, 200, i * segmentAngle, (i + 1) * segmentAngle);
        ctx.fill();

        ctx.save();
        ctx.translate(200, 200);
        ctx.rotate(i * segmentAngle + segmentAngle / 2);
        ctx.fillStyle = "white";
        ctx.font = "16px Arial";
        ctx.textAlign = "right";
        ctx.fillText(segments[i], 180, 10);
        ctx.restore();
      }

      // Triangle de pointeur
      ctx.beginPath();
      ctx.moveTo(200, 0);
      ctx.lineTo(190, 20);
      ctx.lineTo(210, 20);
      ctx.fillStyle = "#000";
      ctx.fill();
    }

    function spinWheel() {
      const rotation = Math.random() * 2000 + 2000;
      const duration = 3000;
      let start = null;

      function animate(timestamp) {
        if (!start) start = timestamp;
        let progress = timestamp - start;
        let angle = easeOutCubic(progress, 0, rotation, duration);
        currentAngle = angle;
        ctx.save();
        ctx.translate(200, 200);
        ctx.rotate((angle * Math.PI) / 180);
        ctx.translate(-200, -200);
        drawWheel();
        ctx.restore();

        if (progress < duration) {
          requestAnimationFrame(animate);
        } else {
          const index = segments.length - Math.floor(((angle % 360) / 360) * segments.length) - 1;
          const result = segments[index];
          if (result === "Gagné") {
            document.getElementById("result").textContent = "🎉 C’est gagné !";
            document.getElementById("emailField").style.display = "block";
            launchConfetti();
            showPopup("🎉 C’est gagné !\nComplétez votre e-mail pour recevoir votre récompense.");
          } else {
            document.getElementById("result").textContent = "😢 Perdu";
            showPopup("😢 Perdu, tu retenteras ta chance la prochaine fois !");
          }
        }
      }

      requestAnimationFrame(animate);
    }

    function easeOutCubic(t, b, c, d) {
      t /= d;
      t--;
      return c * (t * t * t + 1) + b;
    }

    drawWheel();

    // POPUP
    const popup = document.getElementById("popup");
    const popupText = document.getElementById("popupText");
    const popupButton = document.getElementById("popupButton");

    let step = 1;

    popupButton.addEventListener("click", () => {
      if (step === 1) {
        window.open(lienAvisGoogle, "_blank");
        popupText.textContent = "Merci ! Tu peux maintenant tourner la roue 🎡";
        popupButton.textContent = "Tourner la roue";
        step++;
      } else if (step === 2) {
        popup.style.display = "none";
        spinWheel();
      }
    });

    function showPopup(message) {
      popup.style.display = "flex";
      popupText.textContent = message;
      popupButton.style.display = "none";
    }

    // ENVOI EMAIL
    document.getElementById("sendEmailBtn").addEventListener("click", () => {
      const userEmail = document.getElementById("userEmail").value;
      if (!userEmail) return alert("Veuillez saisir votre e-mail");

      const subject = encodeURIComponent(`${nomRestaurant} – C’est gagné !`);
      const body = encodeURIComponent(`Bonjour,

Je viens de gagner à la roue de la fortune de ${nomRestaurant} !

Merci de bien vouloir valider mon gain valable 2 mois.

Cordialement,

---

${nomRestaurant}
Adresse : 123 Rue de la Chance
Tél : 04 00 00 00 00
Email : ${emailRestaurant}`);

      const mailto = `mailto:${emailRestaurant}?cc=${userEmail}&subject=${subject}&body=${body}`;
      window.location.href = mailto;
    });

    // CONFETTIS
    function launchConfetti() {
      for (let i = 0; i < 100; i++) {
        const confetti = document.createElement("div");
        confetti.classList.add("confetti");
        confetti.style.left = Math.random() * window.innerWidth + "px";
        confetti.style.backgroundColor = `hsl(${Math.random() * 360}, 100%, 50%)`;
        document.body.appendChild(confetti);
        setTimeout(() => confetti.remove(), 2000);
      }
    }
  </script>
</body>
</html>

</body>
</html>


