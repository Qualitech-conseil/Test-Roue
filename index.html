<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Roue de la Fortune</title>
  <style>
    html, body {
      margin: 0; padding: 0; height: 100%;
      font-family: Arial, sans-serif;
      background: url('https://www.domaine-sol-payre.com/wp-content/uploads/2024/05/evenement-sol-payre-1.jpg') center/cover no-repeat;
      overflow-x: hidden;
      position: relative;
    }
    .overlay {
      position: absolute; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      backdrop-filter: blur(4px);
      z-index: 0;
      pointer-events: none;
    }
    .content {
      position: relative; z-index: 1;
      color: white; text-align: center;
      padding: 20px 20px 0;
      display: flex; flex-direction: column; align-items: center;
      min-height: 100vh; box-sizing: border-box;
    }
    .content img {
      width: 200px; max-width: 50vw;
      height: auto; margin-bottom: 15px;
    }
    h1 {
      margin-bottom: 20px;
    }
    #lot3count {
      margin: 15px 0; font-weight: bold; font-size: 1.1rem;
    }
    canvas#wheel {
      width: 90vw; height: 90vw;
      max-width: 500px; max-height: 500px;
      margin-top: 15px;
    }
    #indicator {
      position: absolute;
      top: calc(50% - 280px); /* ajustable si besoin */
      left: 50%;
      transform: translateX(-50%) rotate(180deg) ;
      width: 24px; height: 48px;
      z-index: 5;
      pointer-events: none;
    }
    #indicator::after {
      content: ''; display: block;
      width: 24px; height: 48px;
      background: red;
      border-radius: 50% 50% 60% 40% / 40% 60% 50% 50%;
      transform-origin: center bottom;
      animation: sway 0.4s ease-in-out infinite alternate;
      box-shadow: 0 0 5px rgba(255,0,0,0.7);
    }
    @keyframes sway {
      from { transform: rotate(-10deg); }
      to { transform: rotate(10deg); }
    }
    #popup {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex; justify-content: center; align-items: center;
      z-index: 9999; padding: 20px; box-sizing: border-box;
    }
    #popupContent {
      background: white; color: black;
      padding: 20px; border-radius: 10px;
      width: 100%; max-width: 400px; box-sizing: border-box;
    }
    #popupContent input, #popupContent button {
      width: 100%; padding: 12px; margin-top: 10px; font-size: 1em;
      box-sizing: border-box;
    }
    .confetti {
      position: fixed; top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none; z-index: 10000;
    }
    @media (max-width:600px) {
      .content img { width: 150px; }
      h1 { font-size: 1.3rem; }
      #lot3count { font-size: 1rem; }
    }
  </style>
</head>
<body>
  <div class="overlay"></div>
  <div class="content">
    <img src="logo.png" alt="Logo" />
    <h1>Jouez et tentez votre chance en nous laissant un avis Google</h1>
    <div id="lot3count">Le repas gratuit n'a Ã©tÃ© gagnÃ© qu'une seule fois ce mois - il est pour vous peut Ãªtre !!!</div>
    <canvas id="wheel" width="500" height="500"></canvas>
    <div id="indicator"></div>
  </div>

  <div id="popup">
    <div id="popupContent">
      <h2 id="popupMessage">Veuillez laisser un avis Google pour pouvoir jouer.</h2>
      <input type="email" id="emailInput" placeholder="Votre adresse e-mail" style="display:none;" />
      <button id="popupBtn">Laisser un avis Google</button>
    </div>
  </div>

  <canvas id="confettiCanvas" class="confetti"></canvas>

  <script>
    const canvas = document.getElementById('wheel');
    const ctx = canvas.getContext('2d');
    const center = canvas.width/2, radius = center;

    const gains = [
      {label:'ðŸ˜¢ Perdu',win:false},
      {label:'ðŸŽ LotÂ 1',win:true},
      {label:'ðŸ˜¢ Perdu',win:false},
      {label:'ðŸŽ‰ LotÂ 2',win:true},
      {label:'ðŸ˜¢ Perdu',win:false},
      {label:'ðŸ† LotÂ 3',win:true},
      
    ];
    const colors = ['#e6194b','#3cb44b','#ffe119','#4363d8','#f58231','#911eb4'];
    const anglePerSeg = 2*Math.PI/gains.length;

    // Positioner languette
    const indicator = document.getElementById('indicator');
    function posInd() {
      const rect = canvas.getBoundingClientRect();
      indicator.style.top = `${rect.top + window.scrollY}px`;
      indicator.style.left = `${rect.left + window.scrollX + rect.width/2 - 12}px`;
    }
    window.addEventListener('load',posInd);
    window.addEventListener('resize',posInd);

    let currentAngle=0, isSpinning=false, popupStep=1;

    const popup = document.getElementById('popup'),
          popupBtn = document.getElementById('popupBtn'),
          popupMsg = document.getElementById('popupMessage'),
          email = document.getElementById('emailInput'),
          avisURL = "https://www.google.com/search?client=firefox-b-d&sca_esv=ac60e713747e51d1&q=domaine+sol+payr%C3%A9&si=AMgyJEuzsz2NflaaWzrzdpjxXXRaJ2hfdMsbe_mSWso6src8s_V2dAn1SgYwA0t4-2e3O78LiO1M9TvZ0GrFHwJ_rMTtDhaQ4Ivo2YUe_06m8eyz3NNxd0w%3D&uds=AOm0WdGidOdjVhBHIqi6IfHFtxCD-pFhDw12wehonGwc8hQQwj2fv8AgrhQm0jyg8xDOojLspLjfdtGGBkbn7kEKv98O_lGI_QDawxLRqq68h0VlRhHMfq0&sa=X&ved=2ahUKEwj5uq2MroiOAxVHRKQEHRhSHzgQ3PALegQIHRAE&biw=1536&bih=777&dpr=1.25";

    popupBtn.onclick = () => {
      if(popupStep===1){
        window.open(avisURL,'_blank');
        popupMsg.innerText="Vous pouvez maintenant tenter votre chance.";
        popupBtn.innerText="Tourner la roue";
        popupStep=2;
      } else if(popupStep===2 && !isSpinning){
        popup.style.display='none';
        spin();
      }
    };

    function drawWheel(rot=0){
      ctx.clearRect(0,0,canvas.width,canvas.height);
      ctx.save();
      ctx.translate(center,center);
      ctx.rotate(rot);
      ctx.translate(-center,-center);
      for(let i=0;i<gains.length;i++){
        let sa=i*anglePerSeg, ea=sa+anglePerSeg;
        ctx.beginPath();
        ctx.moveTo(center,center);
        ctx.arc(center,center,radius,sa,ea);
        ctx.fillStyle=colors[i];
        ctx.fill();
        ctx.strokeStyle='white';
        ctx.lineWidth=2;
        ctx.stroke();

        // Ð²Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
        ctx.beginPath();
        ctx.moveTo(center,center);
        const lx = center + radius*Math.cos(sa);
        const ly = center + radius*Math.sin(sa);
        ctx.lineTo(lx,ly);
        ctx.stroke();

        // texte
        ctx.save();
        ctx.translate(center,center);
        ctx.rotate(sa+anglePerSeg/2);
        ctx.textAlign='center';
        ctx.textBaseline='middle';
        ctx.fillStyle='white';
        ctx.font='16px Arial';
        ctx.fillText(gains[i].label,radius*0.65,0);
        ctx.restore();
      }
      // points intÃ©rieurs
      const dotN=80;
      for(let j=0;j<dotN;j++){
        const a=(2*Math.PI/dotN)*j;
        const dr=radius-8;
        const x=center+dr*Math.cos(a), y=center+dr*Math.sin(a);
        ctx.beginPath();
        ctx.arc(x,y,3,0,2*Math.PI);
        ctx.fillStyle='white';
        ctx.fill();
      }
      ctx.restore();
    }

    function spin(){
      if(isSpinning) return;
      isSpinning=true;
      const total= Math.random()*360+1440;
      const dur=4000, start=performance.now();
      function anim(t){
        const e=(1-Math.pow(1-((t-start)/dur),3));
        const ang= (total*e)*Math.PI/180;
        currentAngle=ang;
        drawWheel(ang);
        const sway = 10*Math.sin((t-start)/dur*8*Math.PI);
        indicator.style.transform = `rotate(${sway}deg)`;
        if(t-start<dur) requestAnimationFrame(anim);
        else{ isSpinning=false; showResult();}
      }
      requestAnimationFrame(anim);
    }

    function showResult(){
      const norm=(2*Math.PI - currentAngle%(2*Math.PI))%(2*Math.PI);
      const idx=Math.floor((norm + anglePerSeg/2)/anglePerSeg)%gains.length;
      const res=gains[idx];
      popup.style.display='flex';
      email.style.display=res.win?'block':'none';
      if(res.win){
        popupMsg.innerText=`FÃ©licitations ! Vous avez gagnÃ© : ${res.label}`;
        popupBtn.innerText="Envoyer";
        popupBtn.onclick = () => {
          const mail = email.value.trim();
          if(!mail) return alert("Merci de renseigner votre eâ€‘mail.");
          window.location.href = `mailto:restaurant@example.com?cc=${mail}&subject=${encodeURIComponent(`[Nom] â€“ Vous avez gagnÃ© : ${res.label}`)}&body=${encodeURIComponent(`Bravo, vous avez gagnÃ© : ${res.label}.`)}`;
        };
        launchConfetti();
      } else {
        popupMsg.innerText="DÃ©solÃ©, vous avez perdu.";
        popupBtn.innerText="Fermer";
        popupBtn.onclick = ()=>popup.style.display='none';
      }
    }

    // confetti
    const ccv = document.getElementById('confettiCanvas'),
          cctx = ccv.getContext('2d');
    ccv.width=window.innerWidth; ccv.height=window.innerHeight;
    let particles=[];
    function launchConfetti(){
      particles=[];
      for(let i=0;i<150;i++){
        particles.push({
          x:Math.random()*ccv.width,
          y:Math.random()*-ccv.height,
          r:Math.random()*6+4,
          d:Math.random()*10+4,
          color:['#f00','#0f0','#00f','#ff0'][Math.floor(Math.random()*4)],
          tilt:Math.random()*10-5
        });
      }
      requestAnimationFrame(cfDraw);
    }
    function cfDraw(){
      cctx.clearRect(0,0,ccv.width,ccv.height);
      particles.forEach(p=>{
        cctx.beginPath();
        cctx.fillStyle=p.color;
        cctx.ellipse(p.x,p.y,p.r,p.r/2,p.tilt,0,2*Math.PI);
        cctx.fill();
        p.y+=p.d/2;
        p.tilt+=0.1;
      });
      requestAnimationFrame(cfDraw);
    }

    drawWheel();
  </script>
</body>
</html>






